{% extends "base.html" %}

{% block content %}
<div id="header">
      <!-- Header and Scan Submission Inline -->
    <div class="d-flex justify-content-between align-items-center flex-nowrap">
        <a href="/" class="text-decoration-none" aria-label="Go to homepage">
            <h1 class="title">
                <span>LAN</span>scape 
            </h1>
        </a>
        <!-- Right side: settings + form -->
        <div class="d-flex align-items-center justify-content-end ms-auto">
            <form id="scan-form" class="d-flex align-items-center">
                <div class="form-group me-2">
                    <!-- Above subnet input -->
                    <div class="label-container">
                        <label for="subnet">Subnet:</label>
                        <div id="subnet-info"></div>
                    </div>
                    <!-- Subnet input with dropdown -->
                    <div class="input-group">
                        <button
                            type="button"
                            id="settings-btn"
                            class="btn btn-secondary start material-symbols-outlined"
                            data-bs-toggle="tooltip"
                            data-bs-placement="top"
                            title="Advanced scan settings"
                        >
                            settings
                        </button>
                        <input type="text" id="subnet" name="subnet" class="form-control" value="{{ subnet }}" placeholder="Enter subnet">
                        <button class="btn btn-secondary dropdown-toggle end" type="button" id="subnet-dropdown" data-bs-toggle="dropdown" aria-expanded="false"></button>
                        <ul class="dropdown-menu" aria-labelledby="subnet-dropdown" id="dropdown-list">
                            {% for subnet_option in alternate_subnets %}
                            <li><a class="dropdown-item" href="#">{{ subnet_option['subnet'] }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <button type="submit" id="scan-submit" class="btn btn-primary">Scan</button>
            </form>
        </div>
    </div>

    <div id="scan-progress-bar"></div>
</div>

<!-- Advanced Settings Modal -->
<div class="modal fade" id="advancedModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header border-secondary">
        <h5 class="modal-title" id="advancedModalLabel">Advanced Settings</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex gap-2 mb-3">
            <div class="config-option p-3 flex-fill" id="config-fast" data-config="fast" onclick="setScanConfig('fast')">
                <h5 class="mb-1 d-flex align-items-center justify-content-center">
                    <span class="material-symbols-outlined me-1">bolt</span>Fast
                </h5>
                <p class="mb-0">Fast scan, Low accuracy</p>
            </div>
            <div class="config-option p-3 flex-fill" id="config-balanced" data-config="balanced" onclick="setScanConfig('balanced')">
                <h5 class="mb-1 d-flex align-items-center justify-content-center">
                    <span class="material-symbols-outlined me-1">balance</span>Balanced
                </h5>
                <p class="mb-0">Balanced scan, Moderate accuracy</p>
            </div>
            <div class="config-option p-3 flex-fill" id="config-accurate" data-config="accurate" onclick="setScanConfig('accurate')">
                <h5 class="mb-1 d-flex align-items-center justify-content-center">
                    <span class="material-symbols-outlined me-1">target</span>Accurate
                </h5>
                <p class="mb-0">Thorough scan, High accuracy</p>
            </div>
        </div>

        <hr>

        <div class="form-group mt-2">
            <label for="port_list">Port List:</label>
            <div class="port-list-wrapper">
                <div id="port-list" class="port-list">{{port_list}}</div>
                <div id="port-list-dropdown" class="port-list-dropdown"></div>
            </div>
        </div>

        <div class="form-group mt-2">
            <label for="lookup_type">Lookup Type:</label>
            <div class="port-list-wrapper">
                <select id="lookup_type" class="port-list">
                    <option value="both">ARP + Ping</option>
                    <option value="arp">ARP Only</option>
                    <option value="ping">Ping Only</option>
                </select>
            </div>
        </div>

        <hr>

        <div class="form-group mt-2">
            <h6>Thread Settings</h6>
            <div class="row">
                <div class="col">
                    <label for="t_cnt_port_scan">Port Scan Threads</label>
                    <input type="number" id="t_cnt_port_scan" class="form-control">
                </div>
                <div class="col">
                    <label for="t_cnt_port_test">Port Test Threads</label>
                    <input type="number" id="t_cnt_port_test" class="form-control">
                </div>
            </div>
            <div class="row mt-2">
                <div class="col">
                    <label for="t_multiplier">Thread Multiplier</label>
                    <input type="number" step="0.1" id="t_multiplier" class="form-control">
                </div>
                <div class="col">
                    <label for="t_cnt_isalive">Is Alive Threads</label>
                    <input type="number" id="t_cnt_isalive" class="form-control">
                </div>
            </div>
            <div class="mt-2 small">
                Total concurrent port tests: <span id="total-port-tests"></span>
            </div>
        </div>

        <hr>

        <div class="form-group mt-2">
            <h6>Tasks</h6>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="task_scan_ports">
                <label class="form-check-label" for="task_scan_ports">Scan Ports</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="task_scan_port_services">
                <label class="form-check-label" for="task_scan_port_services">Scan Port Services</label>
            </div>
        </div>

        <hr>

        <div class="form-group mt-2">
            <h6>Ping Settings</h6>
            <div class="row">
                <div class="col">
                    <label for="ping_attempts" class="form-label">Ping Attempts</label>
                    <input type="number" id="ping_attempts" class="form-control">
                </div>
                <div class="col">
                    <label for="ping_ping_count" class="form-label">Ping Count</label>
                    <input type="number" id="ping_ping_count" class="form-control">
                </div>
            </div>
            <div class="mt-2 small">
                Total ping attempts: <span id="total-ping-attempts"></span>
            </div>
            <div class="row mt-2">
                <div class="col">
                    <label for="ping_timeout" class="form-label">Timeout</label>
                    <input type="number" step="0.1" id="ping_timeout" class="form-control">
                </div>
                <div class="col">
                    <label for="ping_retry_delay" class="form-label">Retry Delay</label>
                    <input type="number" step="0.1" id="ping_retry_delay" class="form-control">
                </div>
            </div>
        </div>

        <hr>

        <div class="form-group mt-2">
            <h6>ARP Settings</h6>
            <div class="row">
                <div class="col">
                    <label for="arp_attempts" class="form-label">Attempts</label>
                    <input type="number" id="arp_attempts" class="form-control">
                </div>
                <div class="col">
                    <label for="arp_timeout" class="form-label">Timeout</label>
                    <input type="number" step="0.1" id="arp_timeout" class="form-control">
                </div>
            </div>
        </div>
      </div>
      <div class="modal-footer border-secondary">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div id="content">
    <div class="container-fluid my-4">
        <!-- ARP Error -->
        <div id="arp-error" class="{{ 'div-hide' if is_arp_supported else '' }}">
            <span>
                Unable to use ARP lookup. Device discovery is degraded.
                <a target="_blank" href="https://github.com/mdennis281/LANscape/blob/main/support/arp-issues.md">Steps to fix</a>
            </span>
        </div>
        <!-- Scan Results -->
        <div id="scan-results" class="div-hide">
            <div class="d-flex justify-content-between">
                <h2>Scan Results</h2>
                <div id="scan-actions">
                    <a href="" id="export-link">
                        <span 
                            class="material-symbols-outlined secondary-icon-btn"
                            data-bs-toggle="tooltip" 
                            data-bs-placement="top" 
                            title="Export scan to json">
                            ios_share
                        </span>
                    </a>
                </div>
            </div>
            
            {% include 'scan/overview.html' %}
            <input type="text" id="filter" placeholder="Filter results" class="form-control mb-3 mt-3">
            <div class="table-frame-container">
                <iframe id="ip-table-frame" src=""></iframe>
            </div>
        </div>
        <div id="no-scan">
            <h2>No results to show</h2>
            <p>Submit a scan above</p>
        </div>
    </div>
</div>


<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script src="{{ url_for('static', filename='js/subnet-info.js') }}"></script>
<script src="{{ url_for('static', filename='js/subnet-selector.js') }}"></script>
<script src="{{ url_for('static', filename='js/scan-config.js') }}"></script>
{% endblock %}



